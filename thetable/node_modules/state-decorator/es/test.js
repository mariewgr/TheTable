import{isFuncConfig as t,createRef as r,computeDerivedValues as n,onPropChange as e,buildOnMountInvocationContext as o,isSimpleSyncAction as i,decorateSimpleSyncAction as u,isSyncAction as c,decorateSyncAction as s,isAsyncAction as a,computeAsyncActionInput as f,decorateAsyncAction as l,buildErrorMap as p}from"./impl";var v=function(t,r){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},v(t,r)};var d=function(){return d=Object.assign||function(t){for(var r,n=1,e=arguments.length;n<e;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);return t},d.apply(this,arguments)};function m(t,r){return void 0===r&&(r={}),y(t.getConfig(),r)}function y(r,n){void 0===n&&(n={});var e=r.actions,o=function(t,r){var n={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.indexOf(e)<0&&(n[e]=t[e]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(e=Object.getOwnPropertySymbols(t);o<e.length;o++)r.indexOf(e[o])<0&&Object.prototype.propertyIsEnumerable.call(t,e[o])&&(n[e[o]]=t[e[o]])}return n}(r,["actions"]);return P(t(r)?r.getInitialState:function(){return r.initialState},e,n,o)}function P(t,i,u,c,s){void 0===u&&(u={}),void 0===c&&(c={});var a=r(t(u)),f=r(u);function l(t,r,n){return P((function(){return null!=t?t:a.current}),i,null!=r?r:f.current,c,null!=n?n:s)}function p(t,e){void 0===t&&(t=void 0),void 0===e&&(e=void 0);var o=r({state:null,deps:{}});return n(t||a,e||f,o,c),d(d({},(null==t?void 0:t.current)||a.current),o.current.state||{})}return{getInitialState:t,test:function(t){return t(p(),f.current),this},setMockActions:function(t){return l(void 0,void 0,t)},onMount:function(t){return void 0===t&&(t={}),this.onInit(t)},setState:function(t){return l(t,void 0)},setProps:function(t){return l(void 0,t)},setPartialState:function(t){return l(d(d({},a.current),t),void 0)},setPartialProps:function(t){return l(void 0,d(d({},f.current),t))},onPropsChange:function(t,n){void 0===n&&(n=!1);var e=r(a.current),o=r(d(d({},f.current),t)),u=r({state:null,deps:{}}),c=h(i,s),l=this.onPropsChangeImpl(e,o,u,c,(function(t,r,n,o,i){null!=t&&(e.current=t)}),n,!1);return d(d({},l),{test:function(t){t(l)}})},onPropsChangeImpl:function(r,o,i,u,s,l,v){return n(a,f,i,c),e(r,i,o,f.current,u,c,t,s,l,v),{prevState:p(a,f),state:p(r,o),props:o.current,actions:u.current,errorMap:{}}},onInit:function(n){void 0===n&&(n={});var e=d(d({},f.current),n),u=t(e),a=r(u),l=r(e),v=r({state:null,deps:{}}),m=h(i,s),y=function(t,r,n,e,o){null!=t&&(a.current=t)};this.onPropsChangeImpl(a,l,v,m,y,!0,!1),(null==c?void 0:c.onMount)&&c.onMount(o(a,v,l,m)),this.onPropsChangeImpl(a,l,v,m,y,!0,!0),(null==c?void 0:c.onMountDeferred)&&c.onMountDeferred(o(a,v,l,m));var P={prevState:null,state:p(a,l),props:l.current,actions:m.current,errorMap:{}};return d(d({},P),{test:function(t){t(P)}})},getAction:function(t){return b(a.current,t,i,f.current,null,c,void 0)}}}function h(t,n){var e=Object.keys(t);return r(e.reduce((function(t,r){return t[r]=S(null==n?void 0:n[r]),t}),{}))}"function"==typeof SuppressedError&&SuppressedError;var S=function(t){return jest.fn(t)};function g(t){S=t}var O=function(t){function r(n,e,o,i,u){var c=t.call(this,n.message)||this;return Object.setPrototypeOf(c,r.prototype),c.sourceError=n,c.prevState=e,c.props=i,c.state=o,c.actions=u,Error.captureStackTrace&&Error.captureStackTrace(c,r),c}return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}v(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}(r,t),r}(Error);function b(t,e,o,v,m,y,P){var S=r(t),g=r(v),j=m;function E(t,r,n,i){return void 0===i&&(i=P),b(null!=t?t:S.current,e,o,null!=r?r:g.current,null!=n?n:j,y,i)}function M(t,e){void 0===t&&(t=void 0),void 0===e&&(e=void 0);var o=r({state:null,deps:{}});return n(null!=t?t:S,null!=e?e:g,o,y),d(d({},(null==t?void 0:t.current)||S.current),o.current.state||{})}return{setMockActions:function(t){return E(void 0,void 0,void 0,t)},setState:function(t){return E(t,void 0,void 0)},setProps:function(t){return E(void 0,t,void 0)},setPartialState:function(t){return E(d(d({},S.current),t),void 0,void 0)},setPartialProps:function(t){return E(void 0,d(d({},g.current),t),void 0)},promiseResolves:function(t){return E(void 0,void 0,Promise.resolve(t))},promiseRejects:function(t){return E(void 0,void 0,Promise.reject(t))},test:function(t){return t(M(),g.current),this},call:function(){for(var t=[],v=0;v<arguments.length;v++)t[v]=arguments[v];var m=r(d({},S.current)),b=r({state:null,deps:{}});n(m,g,b,y);var E=h(o,P),R=r({}),w=r({}),I=function(t){null!=t&&(m.current=t)},_=o[e],C=null;if(i(_))u(e,_,m,b,g,r(!0),y,I).apply(void 0,t),C=Promise.resolve();else if(c(_))s(e,d(d({},_),{debounceSideEffectsTimeout:0,debounceTimeout:0}),m,b,g,E,r(!0),null,y,I,(function(t){})).apply(void 0,t),C=Promise.resolve();else if(a(_)){var k=r({}),A=r({}),T=r(!0),x=d({},f(_));if(j&&(x.getPromise=function(){return j}),x.optimisticEffects){if(x.effects){var D=x.optimisticEffects,z=x.effects;x.effects=function(t){var r=D(t);return r=d(d({},t.state),r),d(d({},r),z(d(d({},t),{state:r,s:r})))}}else x.effects=x.optimisticEffects;delete x.optimisticEffects}C=l({actionName:e,derivedStateRef:b,propsRef:g,loadingParallelMapRef:R,errorMapRef:w,promisesRef:k,conflictActionsRef:A,initializedRef:T,options:y,setState:I,stateRef:m,actionsRef:E,action:x,clearError:function(t){}}).apply(void 0,t)}return(null!=C?C:Promise.resolve()).then((function(){return R.current={},{prevState:M(S),state:M(m),props:g.current,errorMap:p(w.current),actions:E.current}})).catch((function(t){return Promise.reject(new O(t,M(S),M(m),g.current,E.current))}))}}}export{O as ActionError,m as createMockFromStore,y as createMockStore,b as createMockStoreAction,P as createMockStoreV6,g as setMockFactory};
//# sourceMappingURL=test.js.map
